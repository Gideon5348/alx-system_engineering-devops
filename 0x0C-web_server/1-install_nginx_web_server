#!/usr/bin/env bash
# Bash script to install and configure nginx on web-01 server

# Update package list and install nginx
sudo apt-get update
sudo apt-get install -y nginx

# Create a simple HTML page with the content "Hello World!"
echo "Hello World!" | sudo tee /var/www/html/index.html > /dev/null

# Disable nginx daemon mode to avoid using systemctl for restarting
sudo sed -i 's/daemon on/daemon off/' /etc/nginx/nginx.conf

# Restart nginx without using systemctl
sudo service nginx restart

# Check if nginx is listening on port 80
netstat -tnl | grep ':80 ' > /dev/null
if [ $? -eq 0 ]; then
    echo "Nginx is listening on port 80."
else
    echo "Error: Nginx is not listening on port 80."
fi

# Check if the default page contains "Hello World!"
nginx_default_page=$(curl -s http://localhost)
if [[ $nginx_default_page == *"Hello World!"* ]]; then
    echo "Nginx returns at its root / a page that contains Hello World!"
else
    echo "Error: Nginx does not return a page with Hello World!"
fi